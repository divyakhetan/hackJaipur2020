<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/posenet-similarity/dist/posenet-similarity.min.js"></script> 
</head>
<body>
    

    <script>

        let model;
        let targetLabel = 'C';
        let state = "collection"
        function setup() {
            createCanvas(400, 400);

            let options = {
                inputs: ['x', 'y'],
                outputs: ['label'],
                task: 'classification',
                debug: true
            };

            model = ml5.neuralNetwork(options);
        }

        function keyPressed() {
            if(key === 't') {
                state = "training"
                model.normalizeData();
                let options = {
                    epochs: 300
                };
                model.train(options, whileTraining, finishedTraining);
            } else {
                targetLabel = key.toUpperCase();
            }

        }

        function whileTraining(epoch, loss) {
            console.log('training ', epoch, loss);
        }

        function finishedTraining() {
            console.log('finished training');
            state = 'prediction'
        }

        function mousePressed() {
            let inputs = {
                x: mouseX,
                y: mouseY
            };
            if(state == 'collection'){
                let target = {
                    label: targetLabel
                };
            
           

                model.addData(inputs, target);

                stroke(0);
                noFill();
                ellipse(mouseX, mouseY, 24);
                fill(0);
                noStroke();
                textAlign(CENTER, CENTER);
                text(targetLabel, mouseX, mouseY);
            }
            else if(state == 'prediction'){
                model.classify(inputs, gotResuts);
            }
        }

        function gotResuts(error, results){
            if(error){
                console.log(error);
                return;
            }
            console.log(results);
        }

    </script>
</body>
</html>